(function(t){function e(e){for(var n,i,o=e[0],u=e[1],c=e[2],d=0,f=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);l&&l(e);while(f.length)f.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,o=1;o<a.length;o++){var u=a[o];0!==r[u]&&(n=!1)}n&&(s.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},s=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=u;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"01f0":function(t,e,a){},"30c5":function(t,e,a){"use strict";a("95ec")},"43d7":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],i=a("2877"),o={},u=Object(i["a"])(o,r,s,!1,null,null,null),c=u.exports,l=(a("d3b7"),a("8c4f")),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{height:"100%"}},[a("el-dialog",{attrs:{title:"Who you are?",center:"",visible:!0}},[a("el-container",{staticStyle:{height:"100%"}},[a("el-main",{staticStyle:{height:"100%"}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"My bilibili uid"}},[a("el-input",{model:{value:t.form.uid,callback:function(e){t.$set(t.form,"uid",e)},expression:"form.uid"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("I'm sure")])],1)],1)],1)],1)],1)},f=[],h={name:"Index",data:function(){return{form:{uid:""}}},methods:{onSubmit:function(){var t=this.form.uid;this.$router.push("/"+t)}}},p=h,g=(a("9c2f"),Object(i["a"])(p,d,f,!1,null,"187eef0e",null)),m=g.exports;a("5d6d");n["default"].use(l["a"]);var v=[{path:"/",name:"Root",redirect:{name:"Index"}},{path:"/Index",name:"Index",component:m},{path:"/:uid",name:"Board",component:function(){return Promise.resolve().then(a.bind(null,"5d6d"))},meta:{hasUid:!0}}],b=new l["a"]({mode:"history",base:"/",routes:v}),w=l["a"].prototype.push;l["a"].prototype.push=function(t){return w.call(this,t).catch((function(t){return t}))};var x=b,_=a("2f62");n["default"].use(_["a"]);var y=new _["a"].Store({state:{},mutations:{},actions:{},modules:{}}),k=a("5c96"),C=a.n(k),S=(a("0fae"),a("bc3a")),D=a.n(S);window.location.host;D.a.defaults.baseURL="http://hadoophost:12121",D.a.interceptors.response.use((function(t){return 200===t.status?t:(C.a.Message.error(t.statusText),Promise.reject(t.statusText))})),x.beforeEach((function(t,e,a){if(t.meta.hasUid){var n=parseInt(t.params.uid);(isNaN(n)||n<1||n>7e8)&&(C.a.Message.warning("无效的uid"),a("/Index"))}a()})),n["default"].prototype.$axios=D.a,n["default"].use(C.a),n["default"].config.productionTip=!1,new n["default"]({router:x,store:y,render:function(t){return t(c)}}).$mount("#app")},"5d6d":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Header",{attrs:{processing_info:t.process,uid:t.uid},on:{waitingData:t.waitingData}}),a("el-row",[a("el-col",{attrs:{span:12,align:"center"}},[a("el-card",{staticClass:"box-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("统计信息: 用户性别/等级比例")])]),a("el-row",{staticClass:"statistic-info-class"},[a("el-col",{attrs:{span:12,align:"left"}},[a("SexCountPie",{attrs:{datas:t.sexCount}})],1),a("el-col",{attrs:{span:12,align:"left"}},[a("LevelCountPie",{attrs:{datas:t.levelCount}})],1)],1)],1)],1),a("el-col",{attrs:{span:12,align:"center"}},[a("el-card",{staticClass:"box-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("统计信息: 用户回复时间")])]),a("HourCountBar",{attrs:{datas:t.hourCount}})],1)],1)],1),a("el-container",[a("el-row",[a("el-col",{attrs:{span:12,align:"center"}},[a("ActiveUserTable",{attrs:{title:"评论次数最多",datas:t.rankRData}})],1),a("el-col",{attrs:{span:12,align:"center"}},[a("ActiveUserTable",{attrs:{title:"评论视频最多",datas:t.rankVData}})],1),a("el-col",{attrs:{span:12,align:"center"}},[a("ActiveUserTable",{attrs:{title:"新的访客",datas:t.rankFData}})],1),a("el-col",{attrs:{span:12,align:"center"}},[a("ActiveUserTable",{attrs:{title:"最近评论",datas:t.rankLData}})],1)],1)],1)],1)},r=[],s=(a("4160"),a("159b"),a("5c96")),i=a.n(s),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("VePie",{attrs:{data:t.chartData,settings:t.chartSettings,height:"300px",align:"center",extend:t.chartExtend}})},u=[],c=a("40ea"),l=a.n(c),d={name:"SexCountPie",data:function(){return{chartSettings:{roseType:"radius"},chartExtend:{series:{center:["50%","50%"]}}}},props:["datas"],computed:{chartData:function(){return{columns:["性别","人数"],rows:this.datas||[]}}},components:{VePie:l.a}},f=d,h=a("2877"),p=Object(h["a"])(f,o,u,!1,null,"fae46f40",null),g=p.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("VePie",{attrs:{data:t.chartData,settings:t.chartSettings,height:"350px",align:"center",extend:t.chartExtend}})},v=[],b={name:"LevelCountPie",data:function(){return{chartSettings:{roseType:"radius"},chartExtend:{series:{center:["50%","50%"]}}}},props:["datas"],computed:{chartData:function(){return{columns:["等级","人数"],rows:this.datas||[]}}},components:{VePie:l.a}},w=b,x=Object(h["a"])(w,m,v,!1,null,"83f503ea",null),_=x.exports,y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("VeBar",{attrs:{data:t.chartData}})},k=[],C=a("e8cc"),S=a.n(C),D={name:"HourCountBar",data:function(){return{chartSettings:{dimension:["小时"],metrics:["回复数"]}}},props:["datas"],computed:{chartData:function(){return{columns:["小时","回复数"],rows:this.datas||[]}}},components:{VeBar:S.a}},M=D,O=Object(h["a"])(M,y,k,!1,null,"189b128b",null),P=O.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(t._s(t.title))]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(e){return t.moreUsers()}}},[t._v("more ")])],1),t._l(t.datasFinal.slice(0,5),(function(e){return a("div",{key:e.mid,staticClass:"text item"},[a("el-row",[a("el-col",{attrs:{span:5}},[t._v(" "+t._s(e.rank)+" ")]),a("el-col",{attrs:{span:5}},[a("a",{attrs:{href:"https://space.bilibili.com/"+e.mid,target:"user_space"+e.mid}},[a("el-avatar",{attrs:{shape:"square",size:50,src:e.face}})],1)]),a("el-col",{attrs:{span:6}},[t._v(" "+t._s(e.name)+" ")]),a("el-col",{attrs:{span:6}},[t._v(" "+t._s(e.value)+" ")])],1)],1)}))],2),a("el-dialog",{attrs:{title:t.title,visible:t.visibleSync,width:"auto"},on:{"update:visible":function(e){t.visibleSync=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{"max-height":"600",data:t.dataPage}},[a("el-table-column",{attrs:{label:"排名",prop:"rank",width:"50"}}),a("el-table-column",{attrs:{label:"指标",prop:"value"}}),a("el-table-column",{attrs:{label:"头像"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"https://space.bilibili.com/"+t.row.mid,target:"user_space"+t.row.mid}},[a("el-avatar",{attrs:{shape:"square",size:50,src:t.row.face}})],1)]}}])}),a("el-table-column",{attrs:{label:"用户名称",prop:"name"}}),a("el-table-column",{attrs:{label:"用户id",prop:"mid"}}),a("el-table-column",{attrs:{label:"性别",prop:"sex"}}),a("el-table-column",{attrs:{label:"等级",prop:"level"}}),a("el-table-column",{attrs:{label:"首次访问"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.utils.FormatDateTime(e.row.firstTime))+" ")]}}])}),a("el-table-column",{attrs:{label:"最后访问"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.utils.FormatDateTime(e.row.lastTime))+" ")]}}])})],1),a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,20,40],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.datasFinal.length||0},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},$=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("head",[a("meta",{attrs:{name:"referrer",content:"no-referrer"}})])}];a("fb6a");function j(t){var e=new Date(1e3*t),a=e.getFullYear(),n=e.getMonth()+1;n=n<10?"0"+n:n;var r=e.getDate();r=r<10?"0"+r:r;var s=e.getHours();s=s<10?"0"+s:s;var i=e.getMinutes(),o=e.getSeconds();return i=i<10?"0"+i:i,o=o<10?"0"+o:o,a+"-"+n+"-"+r+" "+s+":"+i+":"+o}var E={FormatDateTime:j},U={name:"ActiveUserTable",data:function(){return{currentPage:1,pageSize:10,visibleSync:!1,utils:E}},props:["title","datas"],methods:{handleSizeChange:function(t){this.pageSize=t},handleCurrentChange:function(t){this.currentPage=t},moreUsers:function(){this.visibleSync=!0}},computed:{datasFinal:function(){return this.datas||[]},dataPage:function(){return this.datasFinal.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)}}},F=U,R=(a("30c5"),Object(h["a"])(F,T,$,!1,null,"6c72dfa1",null)),z=R.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-header",{attrs:{height:"60px"}},[a("el-dropdown",{on:{command:t.handleCommand}},[a("i",{staticClass:"el-icon-setting",staticStyle:{color:"lightgreen","margin-right":"20px"},attrs:{type:"primary"}}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:1}},[t._v("更新")]),a("el-dropdown-item",{attrs:{command:2}},[t._v("返回")])],1)],1),a("span",[t._v(t._s(t.uid)+":"+t._s(t.processing_info))])],1)],1)},I=[],L={name:"Head",props:["uid","processing_info"],methods:{handleCommand:function(t){switch(t){case 1:this.update();break;case 2:this.back();break}},back:function(){this.$router.push("/Index")},update:function(){var t=this;this.$axios.get("api/user/update",{params:{uid:this.uid}}).then((function(e){var a=e.data;200==a.code?(i.a.Message.info("updating user"),t.$emit("waitingData")):202==a.code?i.a.Message.info(a.msg):404==a.code?i.a.Message.warning("unknown user"):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))}))}}},H=L,J=(a("cfb6"),Object(h["a"])(H,V,I,!1,null,"33569991",null)),N=J.exports,B={name:"Board",data:function(){return{uid:0,process:"",sexCount:null,levelCount:null,hourCount:null,rankRData:null,rankVData:null,rankFData:null,rankLData:null,utils:E}},methods:{init:function(){var t=this;this.$axios.get("api/user/init",{params:{uid:this.uid}}).then((function(e){var a=e.data;202==a.code?(i.a.Message.info(a.msg),t.waitingData()):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))}))},waitingData:function(){var t=this;this.$axios.get("api/user/process",{params:{uid:this.uid}}).then((function(e){var a=e.data;t.process=a.msg,202==a.code?setTimeout((function(){t.waitingData()}),1500):200==a.code?t.setData():i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))}))},setData:function(){var t=this,e=this;this.$axios.get("api/statistics_info/sex",{params:{uid:this.uid}}).then((function(t){var a=t.data;e.process=a.msg,202==a.code?i.a.Message.warning("analysis processing"):200==a.code?e.setSexCount(a.data):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))})),this.$axios.get("api/statistics_info/level",{params:{uid:this.uid}}).then((function(t){var a=t.data;e.process=a.msg,202==a.code?i.a.Message.warning("analysis processing"):200==a.code?e.setLevelCount(a.data):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))})),this.$axios.get("api/statistics_info/hour",{params:{uid:this.uid}}).then((function(t){var a=t.data;e.process=a.msg,202==a.code?i.a.Message.warning("analysis processing"):200==a.code?e.setHourCount(a.data):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))})),this.setUserRank("replies","rankR","rankRData","timesR",(function(t){return t+"次"})),this.setUserRank("videos","rankV","rankVData","timesV",(function(t){return t+"个"})),this.setUserRank("new","rankF","rankFData","firstTime",(function(e){return t.utils.FormatDateTime(e)})),this.setUserRank("last","rankL","rankLData","lastTime",(function(e){return t.utils.FormatDateTime(e)}))},setSexCount:function(t){var e=this;this.sexCount=[],t.forEach((function(t){return e.sexCount.push({"性别":t.label,"人数":t.value})})),this.sexCount=this.sexCount},setLevelCount:function(t){var e=this;this.levelCount=[],t.forEach((function(t){return e.levelCount.push({"等级":t.label,"人数":t.value})})),this.levelCount=this.levelCount},setHourCount:function(t){var e=this;this.hourCount=[],t.forEach((function(t){return e.hourCount.push({"小时":parseInt(t.label),"回复数":t.value})})),this.hourCount.sort((function(t,e){return t["小时"]-e["小时"]})),this.hourCount=this.hourCount},setUserRank:function(t,e,a,n,r){var s=this;this.$axios.get("api/active_user/"+t,{params:{uid:this.uid}}).then((function(t){var o=t.data;s.process=o.msg,202==o.code?i.a.Message.warning("analysis processing"):200==o.code?s.setUserRank0(o.data,e,a,n,r):i.a.Message.error("unknown error")})).catch((function(t){i.a.Message.warning(JSON.stringify(t))}))},setUserRank0:function(t,e,a,n,r){this[a]=[];var s=this;t.forEach((function(t){t["rank"]=t[e],t["value"]=r(t[n]),s[a].push(t)})),this[a].sort((function(t,e){return t.rank-e.rank})),this[a]=this[a]}},created:function(){this.uid=parseInt(this.$route.params.uid),this.init()},components:{SexCountPie:g,LevelCountPie:_,HourCountBar:P,ActiveUserTable:z,Header:N}},A=B,q=(a("d1d9"),Object(h["a"])(A,n,r,!1,null,"4c7f604f",null));e["default"]=q.exports},"67ea":function(t,e,a){},"95ec":function(t,e,a){},"9c2f":function(t,e,a){"use strict";a("67ea")},cfb6:function(t,e,a){"use strict";a("01f0")},d1d9:function(t,e,a){"use strict";a("43d7")}});
//# sourceMappingURL=app.ad023a8b.js.map